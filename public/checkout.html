<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Finalizar Compra | English To Go" />
    <title>Finalizar Compra | English To Go</title>
    <link rel="icon" href="https://i.imgur.com/O1F7GGy.png" type="image/png">

    <!-- Global Assets -->
    <link rel="stylesheet" href="assets/css/global.css?v=3.1">
    <script type="module" src="assets/js/components.js?v=3.1"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bre: {
                            base: '#6B21A8', // Morado tipo Bre-B
                            light: '#A855F7',
                            accent: '#D8B4FE'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        pop: {
                            '0%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(1.2)', color: '#D8B4FE' },
                            '100%': { transform: 'scale(1)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        /* Input Styles - Light Theme */
        .input-light {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            color: #0f172a;
            transition: all 0.3s ease;
        }

        .input-light:focus {
            background: white;
            border-color: #7E22CE;
            outline: none;
            box-shadow: 0 0 0 3px rgba(126, 34, 206, 0.15);
        }

        .input-light::placeholder {
            color: #94a3b8;
        }

        select.input-light option {
            background-color: white;
            color: #0f172a;
        }

        /* Bot√≥n de acci√≥n principal */
        .btn-primary-action {
            background: linear-gradient(135deg, #7E22CE 0%, #581C87 100%);
            box-shadow: 0 4px 15px rgba(126, 34, 206, 0.3);
            transition: all 0.3s ease;
        }

        .btn-primary-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(126, 34, 206, 0.5);
            filter: brightness(1.1);
        }

        .btn-primary-action:disabled {
            filter: grayscale(1);
            cursor: not-allowed;
            transform: none;
        }

        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(126, 34, 206, 0.3);
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(126, 34, 206, 0.5);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            color: #334155;
        }

        .calendar-day:hover:not(.empty) {
            background-color: rgba(126, 34, 206, 0.15);
            color: #7E22CE;
            transform: scale(1.1);
        }

        .calendar-day.selected {
            background-color: #7E22CE;
            color: white;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(126, 34, 206, 0.3);
        }

        .calendar-day.today {
            border: 1px solid #7E22CE;
            color: #7E22CE;
        }

        .calendar-day.empty {
            cursor: default;
        }

        /* ===== DESKTOP REFACTOR: Columna Izquierda "Paso 1" ===== */
        @media (min-width: 1024px) {

            /* Ampliar contenedor interno de la columna */
            .checkout-step1>.max-w-md {
                max-width: 32rem;
                /* de 28rem a 32rem */
            }

            /* Ajuste de alineaci√≥n y padding para coincidir con la columna derecha */
            .checkout-step1 {
                padding: 1.5rem 1.5rem !important;
                /* Reducido de 2.5rem para alinear con "Paso 2" */
                justify-content: flex-start !important;
                /* Eliminar centrado vertical (flex-start) */
            }

            /* T√≠tulo "Paso 1: Env√≠a" ‚Äî m√°s grande y con margen inferior */
            .checkout-step1 h2 {
                font-size: 1.875rem;
                /* ~text-3xl */
                margin-bottom: 1.5rem;
            }

            /* Tarjeta de instrucciones ‚Äî texto m√°s legible */
            .checkout-step1 .bg-slate-50.rounded-2xl p.text-xs {
                font-size: 0.875rem;
                /* text-sm */
                line-height: 1.5;
                margin-bottom: 0.875rem;
            }

            /* Opci√≥n Bre-B ‚Äî un poco m√°s grande */
            .checkout-step1 .bg-white.rounded-xl.border .text-xs.font-black {
                font-size: 0.875rem;
            }

            .checkout-step1 .bg-white.rounded-xl.border .text-xs.font-medium {
                font-size: 0.8125rem;
            }

            /* Espaciado entre tarjetas */
            .checkout-step1 .text-center.mb-6,
            .checkout-step1 .text-center.w-full {
                margin-bottom: 1.75rem;
            }

            /* Tarjeta del monto ‚Äî m√°s padding y presencia */
            .checkout-step1 .relative.group {
                margin-bottom: 1.75rem;
            }

            .checkout-step1 .relative.group .relative.bg-white {
                padding: 2rem 1.5rem;
            }

            /* Etiqueta "MONTO EXACTO" ‚Äî m√°s visible */
            .checkout-step1 .text-\[10px\].font-bold.text-slate-400 {
                font-size: 0.6875rem;
                /* 11px */
                letter-spacing: 0.1em;
            }

            /* Monto $ principal ‚Äî m√°s grande */
            .checkout-step1 #display-amount {
                font-size: 3.5rem;
            }

            /* Ref # abajo del monto */
            .checkout-step1 #order-ref-display {
                font-size: 0.6875rem;
            }

            /* Tarjeta llave ‚Äî m√°s padding y n√∫mero m√°s grande */
            .checkout-step1 .cursor-pointer.group .bg-slate-50.rounded-xl {
                padding: 1.25rem 1.5rem;
            }

            /* Etiqueta "ENVIAR A ESTA LLAVE" */
            .checkout-step1 .text-\[10px\].font-bold.text-purple-600 {
                font-size: 0.75rem;
                /* 12px */
            }

            /* N√∫mero de llave */
            .checkout-step1 #numero-llave {
                font-size: 2rem;
            }

            /* Texto "toca para copiar" */
            .checkout-step1 .text-\[10px\].text-slate-400.mt-0\.5 {
                font-size: 0.6875rem;
            }
        }
    </style>
</head>

<body
    class="bg-slate-50 text-slate-900 antialiased overflow-x-hidden lg:overflow-hidden selection:bg-purple-600 selection:text-white relative min-h-screen lg:h-screen flex flex-col">

    <!-- Fondo Ambientaci√≥n - Tema Claro -->
    <div class="fixed inset-0 z-0 pointer-events-none">
        <div class="absolute inset-0 bg-gradient-to-br from-slate-50 via-white to-slate-100"></div>
        <div class="absolute top-[-10%] right-[-10%] w-[600px] h-[600px] rounded-full bg-purple-500/5 blur-[130px]">
        </div>
        <div class="absolute bottom-[-10%] left-[-10%] w-[500px] h-[500px] bg-indigo-500/5 blur-[130px]">
        </div>
    </div>

    <!-- Navbar Standard -->
    <app-header no-sidebar="true" no-cart="true" checkout-mode="true"></app-header>

    <!-- Contenedor Principal ACTUALIZADO A WIDE -->
    <!-- Cambio principal: max-w-4xl a max-w-7xl para el efecto "Wide" -->
    <main
        class="flex-grow flex items-center justify-center px-4 relative z-10 pt-24 pb-6 lg:py-0 lg:h-screen lg:overflow-hidden lg:pt-0">
        <div class="w-full w-[90%] lg:max-w-[1600px] animate-slide-up lg:h-[calc(100vh-100px)] lg:max-h-[600px]">
            <div
                class="glass-panel rounded-3xl overflow-hidden relative border-t border-slate-200 h-full flex flex-col">
                <!-- L√≠nea decorativa superior -->
                <div
                    class="absolute top-0 left-0 w-full h-[3px] bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 z-20">
                </div>

                <!-- Estado de Carga Inicial -->
                <div id="loading-overlay"
                    class="absolute inset-0 z-50 bg-white flex flex-col items-center justify-center">
                    <div
                        class="w-16 h-16 border-4 border-purple-600 border-t-transparent rounded-full animate-spin mb-4">
                    </div>
                    <p class="text-slate-700 font-bold animate-pulse">Cargando detalles del pedido...</p>
                </div>

                <!-- Grid actualizado para pantallas grandes -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-[45%_55%] min-h-[600px] lg:h-full">

                    <!-- COLUMNA 1: INSTRUCCIONES DE PAGO -->
                    <!-- Updated to White Theme & Compact Layout -->
                    <div
                        class="checkout-step1 p-6 md:p-8 lg:p-6 flex flex-col items-center justify-center bg-white border-b md:border-b-0 md:border-r border-slate-200 relative lg:h-full overflow-hidden">

                        <!-- Contenido escalado para pantallas grandes -->
                        <div class="w-full max-w-md flex flex-col items-center">



                            <!-- Instrucciones Redise√±adas (White Theme) -->
                            <div class="text-center mb-6 lg:mb-4 w-full">
                                <h2 class="text-2xl font-black text-slate-800 mb-4">Paso 1: Env√≠a</h2>

                                <div class="bg-slate-50 p-4 rounded-2xl border border-slate-200 shadow-sm w-full">
                                    <p class="text-slate-600 text-xs font-medium mb-3 leading-snug">
                                        Desde tu App Bancaria (Nequi, DaviPlata, etc.), usa la opci√≥n:
                                    </p>

                                    <div
                                        class="bg-white px-4 py-3 rounded-xl border border-slate-200 shadow-sm flex items-center justify-center gap-3">
                                        <div class="bg-purple-100 p-1.5 rounded-lg shrink-0">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-purple-600"
                                                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
                                            </svg>
                                        </div>
                                        <div class="text-left">
                                            <span
                                                class="text-slate-800 font-black text-xs tracking-wide block leading-none mb-0.5">Bre-B:</span>
                                            <span class="text-slate-500 font-medium text-xs block leading-tight">Enviar
                                                a
                                                Llaves de otros bancos</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tarjeta Visual del Monto (White Theme) -->
                            <div class="relative group mb-6 lg:mb-4 w-full">
                                <div
                                    class="relative bg-white p-6 lg:p-6 rounded-xl border border-slate-200 shadow-lg flex flex-col items-center text-center">
                                    <div class="space-y-1">
                                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Monto
                                            Exacto
                                            a Transferir</p>
                                        <p class="text-4xl lg:text-5xl font-black text-slate-800 tracking-tight"
                                            id="display-amount">--- <span
                                                class="text-lg text-slate-400 font-bold align-top ml-1">COP</span></p>
                                        <p class="text-[10px] text-slate-400 mt-1 font-mono" id="order-ref-display">Ref:
                                            #---
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Bot√≥n de Copiar Llave (White Theme) -->
                            <div class="w-full cursor-pointer group" onclick="copiarNumero()">
                                <div class="relative">
                                    <div
                                        class="relative bg-slate-50 p-4 rounded-xl border border-slate-200 flex justify-between items-center hover:bg-slate-100 transition-colors">
                                        <div class="flex flex-col">
                                            <span
                                                class="text-[10px] font-bold text-purple-600 uppercase tracking-wider mb-0.5">üëâ
                                                Enviar a esta Llave:</span>
                                            <span
                                                class="text-2xl lg:text-3xl font-mono font-black text-slate-800 tracking-widest"
                                                id="numero-llave">1102380577</span>
                                            <span
                                                class="text-[10px] text-slate-400 mt-0.5 font-medium group-hover:text-purple-600 transition-colors">Toca
                                                para copiar</span>
                                        </div>
                                        <div
                                            class="w-10 h-10 bg-white rounded-full flex items-center justify-center border border-slate-200 group-hover:border-purple-500 shadow-sm transition-colors">
                                            <svg class="w-5 h-5 text-slate-400 group-hover:text-purple-600" fill="none"
                                                stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                                                </path>
                                            </svg>
                                        </div>
                                        <div id="copiado-msg"
                                            class="absolute inset-0 bg-purple-600 text-white text-lg font-black flex items-center justify-center rounded-xl opacity-0 transition-opacity z-20 pointer-events-none">
                                            ¬°COPIADO! üíé</div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- COLUMNA 2: REPORTE Y VALIDACI√ìN -->
                    <div class="flex flex-col justify-center bg-slate-50/80 relative w-full">

                        <!-- PANTALLA 1: FORMULARIO -->
                        <!-- Padding ajustado para viewport fijo -->
                        <!-- PANTALLA 1: FORMULARIO -->
                        <!-- Scrollbar visible solo si es estrictamente necesario -->
                        <div id="form-content"
                            class="p-6 md:p-8 lg:p-6 lg:pb-32 h-full flex flex-col justify-center w-full animate-fade-in max-w-2xl mx-auto lg:overflow-y-auto custom-scrollbar">
                            <div class="mb-6">
                                <h2 class="text-2xl font-black text-slate-800 mb-2">Paso 2: Reporta</h2>
                                <p class="text-slate-500 text-sm leading-relaxed">
                                    Completa los datos para <strong class="text-slate-700">liberar tus
                                        materiales</strong>.
                                    materiales inmediatamente</strong>.
                                </p>
                            </div>

                            <form id="payment-form" class="space-y-4">

                                <!-- WARNING BLOCK: MOVED AND STYLED -->
                                <div
                                    class="bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-xl mb-6 shadow-sm flex gap-3 items-start animate-fade-in">
                                    <div class="text-2xl mt-0.5">‚ö†Ô∏è</div>
                                    <div>
                                        <p class="text-amber-900 font-black text-base mb-1">IMPORTANTE:</p>
                                        <p class="text-amber-800 text-sm font-medium leading-relaxed">
                                            Ingresa la <strong>fecha y hora exactas</strong> tal cual aparecen en tu
                                            comprobante bancario.
                                            <br><span class="text-xs opacity-80">Si los datos no coinciden, el sistema
                                                no podr√° verificar tu pago.</span>
                                        </p>
                                    </div>
                                </div>

                                <!-- 1. NOMBRE COMPLETO -->
                                <div class="space-y-2">
                                    <label
                                        class="text-[10px] font-bold text-slate-500 ml-1 uppercase tracking-wider">Nombre
                                        Completo (Titular) <span class="text-red-500">*</span></label>
                                    <input type="text" id="nombre" placeholder="Ej: Juan P√©rez" required
                                        class="input-light w-full px-4 py-3 rounded-xl text-base font-medium">
                                </div>

                                <!-- 2. BANCO -->
                                <div class="space-y-2 relative" id="banco-container">
                                    <label
                                        class="text-[10px] font-bold text-slate-500 ml-1 uppercase tracking-wider">Banco
                                        que usaste <span class="text-red-500">*</span></label>
                                    <select id="banco" required class="hidden">
                                        <option value="" disabled selected>Selecciona tu banco...</option>
                                        <optgroup label="M√°s Comunes">
                                            <option value="Nequi">Nequi</option>
                                            <option value="Daviplata">Daviplata</option>
                                            <option value="Bancolombia">Bancolombia / A la mano</option>
                                            <option value="NU">NU (Nubank)</option>
                                            <option value="RappiPay">RappiPay</option>
                                        </optgroup>
                                        <optgroup label="Otros Bancos">
                                            <option value="BAN100">BAN100</option>
                                            <option value="Banco Agrario">Banco Agrario</option>
                                            <option value="Banco AV Villas">Banco AV Villas</option>
                                            <option value="Banco Caja Social">Banco Caja Social</option>
                                            <option value="Davivienda">Davivienda</option>
                                            <option value="Banco de Bogota">Banco de Bogota</option>
                                            <option value="Banco de Occidente">Banco de Occidente</option>
                                            <option value="Banco Falabella">Banco Falabella</option>
                                            <option value="GNB Sudameris">GNB Sudameris</option>
                                            <option value="Banco Pichincha">Banco Pichincha</option>
                                            <option value="Banco Popular">Banco Popular</option>
                                            <option value="Banco Santander">Banco Santander</option>
                                            <option value="BBVA">BBVA Colombia</option>
                                            <option value="CITIbank">CITIbank</option>
                                            <option value="Colpatria">Scotiabank Colpatria</option>
                                            <option value="Ita√∫">Ita√∫</option>
                                            <option value="Lulo Bank">Lulo Bank</option>
                                            <option value="Movii">Movii</option>
                                            <option value="Ual√°">Ual√°</option>
                                        </optgroup>
                                    </select>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                                    <!-- 3. FECHA -->
                                    <div class="space-y-2 relative" id="date-picker-wrapper">
                                        <label
                                            class="text-[10px] font-bold text-slate-500 ml-1 uppercase tracking-wider">Fecha
                                            del Pago <span class="text-red-500">*</span></label>
                                        <input type="date" id="fecha" required class="hidden">
                                        <button type="button" id="date-trigger"
                                            class="input-light w-full px-4 py-3 rounded-xl text-base font-medium text-left flex justify-between items-center group">
                                            <span id="date-text" class="text-slate-400 truncate">Selecciona
                                                fecha...</span>
                                            <svg class="w-5 h-5 text-slate-400 transition-transform duration-200 group-hover:text-purple-600"
                                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                                </path>
                                            </svg>
                                        </button>
                                        <div id="calendar-dropdown"
                                            class="hidden absolute bottom-full left-0 w-[300px] mb-2 bg-white border border-slate-200 rounded-xl shadow-[0_15px_50px_rgba(0,0,0,0.15)] p-4 z-50">
                                            <div class="flex justify-between items-center mb-4 gap-2">
                                                <button type="button" id="prev-month"
                                                    class="p-1 hover:bg-slate-100 rounded-full transition-colors text-slate-400 hover:text-slate-700 shrink-0">
                                                    <svg class="w-5 h-5" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                                    </svg>
                                                </button>
                                                <div class="flex gap-2 w-full justify-center">
                                                    <select id="cal-month-select"
                                                        class="bg-slate-100 hover:bg-slate-200 text-slate-700 text-xs font-bold rounded px-2 py-1.5 cursor-pointer outline-none transition-colors appearance-none text-center border border-slate-200 focus:border-purple-500"></select>
                                                    <select id="cal-year-select"
                                                        class="bg-slate-100 hover:bg-slate-200 text-slate-700 text-xs font-bold rounded px-2 py-1.5 cursor-pointer outline-none transition-colors appearance-none text-center border border-slate-200 focus:border-purple-500"></select>
                                                </div>
                                                <button type="button" id="next-month"
                                                    class="p-1 hover:bg-slate-100 rounded-full transition-colors text-slate-400 hover:text-slate-700 shrink-0">
                                                    <svg class="w-5 h-5" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2" d="M9 5l7 7-7 7"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="grid grid-cols-7 gap-1 mb-2">
                                                <div class="text-center text-[10px] font-bold text-slate-400 uppercase">
                                                    Do</div>
                                                <div class="text-center text-[10px] font-bold text-slate-400 uppercase">
                                                    Lu</div>
                                                <div class="text-center text-[10px] font-bold text-slate-400 uppercase">
                                                    Ma</div>
                                                <div class="text-center text-[10px] font-bold text-slate-400 uppercase">
                                                    Mi</div>
                                                <div class="text-center text-[10px] font-bold text-slate-400 uppercase">
                                                    Ju</div>
                                                <div class="text-center text-[10px] font-bold text-slate-400 uppercase">
                                                    Vi</div>
                                                <div class="text-center text-[10px] font-bold text-slate-400 uppercase">
                                                    Sa</div>
                                            </div>
                                            <div id="calendar-days" class="calendar-grid"></div>
                                        </div>
                                    </div>

                                    <!-- 4. HORA -->
                                    <div class="space-y-2">
                                        <label
                                            class="text-[10px] font-bold text-slate-500 ml-1 uppercase tracking-wider">Hora
                                            del Pago <span class="text-red-500">*</span></label>
                                        <div class="flex gap-1 h-[50px]">
                                            <input type="number" id="hora-hh" min="1" max="12" placeholder="--" required
                                                class="input-light w-1/3 rounded-l-xl text-center font-bold text-lg">
                                            <input type="number" id="hora-mm" min="0" max="59" placeholder="--" required
                                                class="input-light w-1/3 text-center font-bold border-l-0 border-r-0 text-lg">
                                            <div class="w-1/3 flex flex-col h-full">
                                                <button type="button" id="btn-am" onclick="toggleAmPm('am')"
                                                    class="h-1/2 bg-slate-100 text-slate-500 text-xs rounded-tr-xl border border-slate-200 hover:bg-slate-200 transition-colors">AM</button>
                                                <button type="button" id="btn-pm" onclick="toggleAmPm('pm')"
                                                    class="h-1/2 bg-purple-600 text-white font-bold text-xs rounded-br-xl border border-purple-600 hover:bg-purple-700 transition-colors">PM</button>
                                            </div>
                                            <input type="hidden" id="hora-ampm" value="pm">
                                        </div>
                                    </div>
                                </div>



                                <button type="submit" id="btn-pre-submit"
                                    class="btn-primary-action w-full py-3 rounded-xl text-white font-bold text-lg tracking-wide shadow-lg flex items-center justify-center gap-2 mt-4">
                                    <span>Confirmar Pago üöÄ</span>
                                </button>
                            </form>
                        </div>

                        <!-- PANTALLA 2: RESUMEN DE DATOS -->
                        <div id="summary-content"
                            class="hidden w-full h-full flex flex-col justify-center p-6 md:p-8 lg:p-8 animate-fade-in max-w-2xl mx-auto">
                            <h2 class="text-2xl font-black text-slate-800 mb-2">Verifica tus datos</h2>
                            <p class="text-slate-500 text-sm mb-6 leading-relaxed">
                                Confirma que la informaci√≥n coincida exactamente con tu comprobante.
                            </p>

                            <div
                                class="bg-white rounded-2xl p-6 border border-slate-200 space-y-4 mb-6 relative overflow-hidden shadow-sm">
                                <div
                                    class="absolute top-0 right-0 w-32 h-32 bg-purple-500/5 rounded-full blur-3xl -mr-8 -mt-8 pointer-events-none">
                                </div>

                                <div class="border-b border-slate-100 pb-3">
                                    <span
                                        class="text-[10px] uppercase font-bold text-slate-400 tracking-wider block mb-1">Titular
                                        de la cuenta</span>
                                    <p class="text-slate-800 font-bold text-xl leading-tight" id="summary-nombre">
                                        Cargando...</p>
                                </div>

                                <div class="border-b border-slate-100 pb-3">
                                    <span
                                        class="text-[10px] uppercase font-bold text-slate-400 tracking-wider block mb-1">Banco
                                        Origen</span>
                                    <p class="text-purple-600 font-bold text-xl leading-tight" id="summary-banco">
                                        Cargando...</p>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <span
                                            class="text-[10px] uppercase font-bold text-slate-400 tracking-wider block mb-1">Fecha</span>
                                        <p class="text-slate-800 font-bold text-lg leading-tight" id="summary-fecha">
                                            --/--/--</p>
                                    </div>
                                    <div>
                                        <span
                                            class="text-[10px] uppercase font-bold text-slate-400 tracking-wider block mb-1">Hora</span>
                                        <p class="text-slate-800 font-bold text-lg leading-tight" id="summary-hora">
                                            --:--
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="flex flex-col sm:flex-row gap-3">
                                <button id="btn-edit" type="button"
                                    class="order-2 sm:order-1 w-full sm:w-1/3 py-3 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 hover:text-slate-800 transition-colors text-base">
                                    Editar
                                </button>
                                <button id="btn-confirm" type="button"
                                    class="order-1 sm:order-2 w-full sm:w-2/3 py-3 rounded-xl bg-purple-600 text-white font-bold hover:bg-purple-700 transition-all shadow-lg shadow-purple-500/20 hover:shadow-purple-500/40 hover:-translate-y-1 text-base">
                                    Confirmar y Enviar
                                </button>
                            </div>

                            <div id="loading-indicator" class="hidden mt-6 text-center">
                                <div
                                    class="inline-block w-8 h-8 border-4 border-slate-200 border-t-purple-600 rounded-full animate-spin mb-2">
                                </div>
                                <p class="text-xs font-bold text-slate-500 animate-pulse">Enviando reporte...</p>
                            </div>
                        </div>

                        <!-- PANTALLA 3: √âXITO -->
                        <div id="success-content"
                            class="hidden w-full h-full bg-gradient-to-br from-green-50 to-emerald-100 backdrop-blur-lg flex flex-col items-center justify-center p-6 md:p-8 lg:p-8 text-center animate-fade-in rounded-br-3xl rounded-bl-3xl md:rounded-bl-none md:rounded-tr-3xl">

                            <div class="relative w-20 h-20 mb-6 flex items-center justify-center">
                                <div class="absolute inset-0 bg-green-500 rounded-full animate-ping opacity-20"></div>
                                <div
                                    class="relative w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center border border-green-500/30 shadow-[0_0_30px_rgba(74,222,128,0.2)]">
                                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                            d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </div>
                            </div>

                            <h3 class="text-2xl font-black text-slate-800 mb-3">¬°Reporte Recibido!</h3>
                            <p class="text-slate-600 text-sm mb-6 leading-relaxed max-w-sm mx-auto">
                                Hemos recibido los datos de tu pago. Estamos verificando la transacci√≥n.
                            </p>

                            <div
                                class="bg-white p-5 rounded-2xl border border-green-200 w-full max-w-sm mb-8 relative overflow-hidden shadow-lg">
                                <div id="progress-bar"
                                    class="absolute bottom-0 left-0 h-1 bg-gradient-to-r from-green-500 to-emerald-400 transition-all duration-1000 ease-linear"
                                    style="width: 100%"></div>

                                <p class="text-slate-700 text-sm font-bold mb-2 flex items-center justify-center gap-2">
                                    <span class="inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                    Validando tu pago...
                                </p>
                                <p class="text-slate-500 text-[10px] leading-snug mb-4">
                                    Te notificaremos en cuanto tus materiales est√©n listos.
                                </p>

                                <a href="/"
                                    class="bg-slate-800 text-white font-bold py-3 px-8 rounded-full hover:bg-slate-700 transition-all inline-block w-full max-w-xs shadow-lg text-sm">
                                    Volver al Cat√°logo
                                </a>

                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <p class="text-center text-zinc-600 text-xs mt-4">
                &copy; 2026 English To Go. Pagos seguros v√≠a Bre-B.
            </p>
        </div>
    </main>

    <!-- SCRIPTS -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initCustomSelect();
            initCustomCalendar();

            // --- L√ìGICA ESTRICTA DE HORA ---
            const horaInput = document.getElementById('hora-hh');
            const minInput = document.getElementById('hora-mm');

            horaInput.addEventListener('input', function () {
                if (this.value.length > 2) this.value = this.value.slice(0, 2);
                let val = parseInt(this.value);
                if (isNaN(val)) return;
                if (val > 12) this.value = this.value.slice(0, -1);
            });

            horaInput.addEventListener('blur', function () {
                let val = parseInt(this.value);
                if (val === 0) this.value = 12;
            });

            minInput.addEventListener('input', function () {
                if (this.value.length > 2) this.value = this.value.slice(0, 2);
                let val = parseInt(this.value);
                if (val > 59) this.value = 59;
                if (val < 0) this.value = 0;
            });
        });

        // --- CUSTOM DATEPICKER LOGIC ---
        function initCustomCalendar() {
            const trigger = document.getElementById('date-trigger');
            const dropdown = document.getElementById('calendar-dropdown');
            const dateText = document.getElementById('date-text');
            const hiddenInput = document.getElementById('fecha');
            const wrapper = document.getElementById('date-picker-wrapper');
            const monthSelect = document.getElementById('cal-month-select');
            const yearSelect = document.getElementById('cal-year-select');
            const daysContainer = document.getElementById('calendar-days');
            const prevBtn = document.getElementById('prev-month');
            const nextBtn = document.getElementById('next-month');

            let currentDate = new Date();
            let selectedDate = new Date();
            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

            monthNames.forEach((name, index) => {
                const opt = document.createElement('option');
                opt.value = index;
                opt.textContent = name;
                monthSelect.appendChild(opt);
            });

            const currentYear = new Date().getFullYear();
            for (let y = currentYear - 2; y <= currentYear + 5; y++) {
                const opt = document.createElement('option');
                opt.value = y;
                opt.textContent = y;
                yearSelect.appendChild(opt);
            }

            const formatDateValue = (date) => date.toISOString().split('T')[0];
            const formatDateDisplay = (date) => {
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            };

            hiddenInput.value = formatDateValue(selectedDate);
            dateText.textContent = formatDateDisplay(selectedDate);
            dateText.classList.remove('text-zinc-500');
            dateText.classList.add('text-slate-900');

            function renderCalendar() {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();

                monthSelect.value = month;
                yearSelect.value = year;
                daysContainer.innerHTML = '';

                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                for (let i = 0; i < firstDay; i++) {
                    const empty = document.createElement('div');
                    empty.className = 'calendar-day empty';
                    daysContainer.appendChild(empty);
                }

                for (let i = 1; i <= daysInMonth; i++) {
                    const dayEl = document.createElement('div');
                    dayEl.className = 'calendar-day';
                    dayEl.textContent = i;

                    if (selectedDate &&
                        selectedDate.getDate() === i &&
                        selectedDate.getMonth() === month &&
                        selectedDate.getFullYear() === year) {
                        dayEl.classList.add('selected');
                    }

                    const today = new Date();
                    if (today.getDate() === i && today.getMonth() === month && today.getFullYear() === year) {
                        dayEl.classList.add('today');
                    }

                    dayEl.onclick = (e) => {
                        e.stopPropagation();
                        selectedDate = new Date(year, month, i);
                        hiddenInput.value = formatDateValue(selectedDate);
                        dateText.textContent = formatDateDisplay(selectedDate);
                        dropdown.classList.add('hidden');
                        trigger.classList.remove('ring-2', 'ring-purple-500/20');
                        renderCalendar();
                    };
                    daysContainer.appendChild(dayEl);
                }
            }

            monthSelect.onchange = (e) => { e.stopPropagation(); currentDate.setMonth(parseInt(e.target.value)); renderCalendar(); };
            yearSelect.onchange = (e) => { e.stopPropagation(); currentDate.setFullYear(parseInt(e.target.value)); renderCalendar(); };
            monthSelect.onclick = (e) => e.stopPropagation();
            yearSelect.onclick = (e) => e.stopPropagation();
            prevBtn.onclick = (e) => { e.stopPropagation(); currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); };
            nextBtn.onclick = (e) => { e.stopPropagation(); currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); };

            trigger.onclick = (e) => {
                e.stopPropagation();
                const isOpen = !dropdown.classList.contains('hidden');
                document.querySelectorAll('.absolute.z-50').forEach(el => { if (el !== dropdown) el.classList.add('hidden'); });
                if (isOpen) {
                    dropdown.classList.add('hidden');
                    trigger.classList.remove('ring-2', 'ring-purple-500/20');
                } else {
                    dropdown.classList.remove('hidden');
                    trigger.classList.add('ring-2', 'ring-purple-500/20');
                    renderCalendar();
                }
            };

            document.addEventListener('click', (e) => {
                if (!wrapper.contains(e.target)) {
                    dropdown.classList.add('hidden');
                    trigger.classList.remove('ring-2', 'ring-purple-500/20');
                }
            });

            renderCalendar();
        }

        // --- CUSTOM SELECT LOGIC ---
        function initCustomSelect() {
            const select = document.getElementById('banco');
            const container = document.getElementById('banco-container');

            const wrapper = document.createElement('div');
            wrapper.className = 'relative w-full';

            const trigger = document.createElement('button');
            trigger.type = 'button';
            trigger.className = 'input-light w-full px-4 py-3 rounded-xl text-base font-medium text-left flex justify-between items-center group';
            trigger.innerHTML = `
                <span id="selected-text" class="text-slate-400 truncate mr-2">Selecciona tu banco...</span>
                <svg class="w-5 h-5 text-slate-400 transition-transform duration-200 group-hover:text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            `;

            // Portal Menu - FIXED positioning appended to BODY
            const menu = document.createElement('div');
            menu.id = 'custom-bank-menu';
            // Start hidden, fixed position, high z-index
            menu.className = 'hidden fixed z-[9999] bg-white border border-slate-200 rounded-xl shadow-[0_10px_40px_rgba(0,0,0,0.15)] overflow-y-auto custom-scrollbar';

            // Append directly to body to escape any overflow:hidden parents
            document.body.appendChild(menu);

            const buildOptions = () => {
                menu.innerHTML = '';
                Array.from(select.children).forEach(child => {
                    if (child.tagName === 'OPTGROUP') {
                        const label = document.createElement('div');
                        label.className = 'px-4 py-2 text-[10px] font-bold text-purple-600 uppercase tracking-wider bg-slate-50 sticky top-0 border-b border-slate-100';
                        label.textContent = child.label;
                        menu.appendChild(label);
                        Array.from(child.children).forEach(opt => createOption(opt));
                    } else if (child.tagName === 'OPTION') {
                        createOption(child);
                    }
                });
            };

            const createOption = (option) => {
                if (option.disabled) return;
                const item = document.createElement('div');
                item.className = 'px-4 py-3 text-base text-slate-700 hover:bg-purple-50 hover:text-purple-700 cursor-pointer transition-colors border-b border-slate-100 last:border-0 active:bg-purple-100';
                item.textContent = option.text;
                item.onclick = (e) => {
                    e.stopPropagation(); // Stop propagation
                    select.value = option.value;
                    trigger.querySelector('#selected-text').textContent = option.text;
                    trigger.querySelector('#selected-text').classList.remove('text-slate-400');
                    trigger.querySelector('#selected-text').classList.add('text-slate-800');
                    trigger.classList.add('border-purple-500', 'bg-white');
                    closeMenu();
                };
                menu.appendChild(item);
            };

            buildOptions();

            const updateMenuPosition = () => {
                const rect = trigger.getBoundingClientRect();
                const viewportHeight = window.innerHeight;
                const spaceBelow = viewportHeight - rect.bottom - 10; // 10px padding
                const spaceAbove = rect.top - 10;

                // Reset styles
                menu.style.position = 'fixed';
                menu.style.width = `${rect.width}px`;
                menu.style.left = `${rect.left}px`;

                // Logic: Prefer bottom, unless very tight (< 200px) and top has more space
                if (spaceBelow < 200 && spaceAbove > spaceBelow) {
                    // Show above
                    menu.style.top = 'auto';
                    menu.style.bottom = `${viewportHeight - rect.top + 5}px`;
                    menu.style.maxHeight = `${Math.min(300, spaceAbove)}px`;
                } else {
                    // Show below
                    menu.style.top = `${rect.bottom + 5}px`;
                    menu.style.bottom = 'auto';
                    menu.style.maxHeight = `${Math.min(300, spaceBelow)}px`; // Cap at 300px or available space
                }
            };

            const closeMenu = () => {
                if (!menu.classList.contains('hidden')) {
                    menu.classList.add('hidden');
                    const icon = trigger.querySelector('svg');
                    if (icon) icon.style.transform = 'rotate(0deg)';
                    trigger.classList.remove('ring-2', 'ring-purple-500/20');
                }
            };

            trigger.onclick = (e) => {
                e.preventDefault();
                e.stopPropagation();
                const isOpen = !menu.classList.contains('hidden');

                // Close others
                document.querySelectorAll('.fixed.z-\\[9999\\]').forEach(el => {
                    if (el !== menu) el.classList.add('hidden');
                });

                if (isOpen) {
                    closeMenu();
                } else {
                    menu.classList.remove('hidden');
                    updateMenuPosition(); // Recalculate position

                    const icon = trigger.querySelector('svg');
                    if (icon) icon.style.transform = 'rotate(180deg)';
                    trigger.classList.add('ring-2', 'ring-purple-500/20');
                }
            };

            // Close interactions
            // FIXED: Only close on window scroll, NOT on menu scroll
            window.addEventListener('scroll', (e) => {
                const menuEl = document.getElementById('custom-bank-menu');
                if (menuEl && (e.target === menuEl || menuEl.contains(e.target))) {
                    return; // Ignore scroll inside menu
                }
                closeMenu();
            }, true);

            window.addEventListener('resize', closeMenu);

            document.addEventListener('click', (e) => {
                if (!wrapper.contains(e.target)) {
                    // Check if click is inside the portal menu (since it's not in wrapper)
                    const menuEl = document.getElementById('custom-bank-menu');
                    if (menuEl && !menuEl.contains(e.target)) {
                        closeMenu();
                    }
                }
            });

            select.parentNode.insertBefore(wrapper, select);
            wrapper.appendChild(select);
            wrapper.appendChild(trigger);
            // Note: Menu is appended to document.body, not wrapper
        }

        function copiarNumero() {
            const numero = "1102380577";
            const textArea = document.createElement("textarea");
            textArea.value = numero;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                const msg = document.getElementById('copiado-msg');
                msg.style.opacity = '1';
                setTimeout(() => msg.style.opacity = '0', 2000);
            } catch (err) { console.error(err); }
            document.body.removeChild(textArea);
        }

        window.toggleAmPm = function (value) {
            const input = document.getElementById('hora-ampm');
            const btnAm = document.getElementById('btn-am');
            const btnPm = document.getElementById('btn-pm');
            input.value = value;
            const activeClasses = ['bg-bre-base', 'text-white', 'font-bold', 'hover:bg-bre-light'];
            const inactiveClasses = ['bg-white/5', 'text-zinc-400', 'hover:bg-white/10'];

            if (value === 'am') {
                btnAm.classList.remove(...inactiveClasses);
                btnAm.classList.add(...activeClasses);
                btnPm.classList.remove(...activeClasses);
                btnPm.classList.add(...inactiveClasses);
                btnPm.classList.remove('font-bold');
            } else {
                btnPm.classList.remove(...inactiveClasses);
                btnPm.classList.add(...activeClasses);
                btnAm.classList.remove(...activeClasses);
                btnAm.classList.add(...inactiveClasses);
                btnAm.classList.remove('font-bold');
            }
        }
    </script>

    <!-- FIREBASE LOGIC -->
    <script type="module">
        // Importar desde la configuraci√≥n centralizada
        import { auth, db } from './assets/js/firebase-app.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
        import { collection, addDoc, serverTimestamp, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        let currentUser = null;
        let currentOrder = null;
        let orderTotal = 0;



        // UI Refs
        const displayAmount = document.getElementById('display-amount');
        const orderRefDisplay = document.getElementById('order-ref-display');
        const loadingOverlay = document.getElementById('loading-overlay');
        const form = document.getElementById('payment-form');
        const formContent = document.getElementById('form-content');
        const summaryContent = document.getElementById('summary-content');
        const successContent = document.getElementById('success-content');
        const btnEdit = document.getElementById('btn-edit');
        const btnConfirm = document.getElementById('btn-confirm');
        const loadingIndicator = document.getElementById('loading-indicator');

        // Form Data
        let tempData = {};

        // 1. OBTENER ORDER ID DE URL
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('order_id');

        if (!orderId) {
            alert("Error: No se ha especificado un pedido v√°lido.");
            window.location.href = "/catalogo.html";
        }

        // 2. AUTH & LOAD ORDER
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                await loadOrderDetails(orderId);
            } else {
                // Si no est√° logueado, redirigir a login, volviendo aqu√≠ despu√©s
                const currentUrl = window.location.href;
                window.location.href = `/auth/login.html?returnTo=${encodeURIComponent(currentUrl)}`;
            }
        });

        async function loadOrderDetails(id) {
            try {
                const docRef = doc(db, "orders", id);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    currentOrder = docSnap.data();

                    // Validar que el usuario sea el due√±o de la orden
                    if (currentOrder.user_id !== currentUser.uid) {
                        alert("No tienes permiso para ver este pedido.");
                        window.location.href = "/";
                        return;
                    }

                    // Mostrar info
                    orderTotal = currentOrder.final_total;
                    displayAmount.innerHTML = `$ ${orderTotal.toLocaleString('es-CO')} <span class="text-xl text-zinc-400 font-bold align-top ml-1">COP</span>`;
                    orderRefDisplay.textContent = `Ref: #${id.slice(0, 8).toUpperCase()}`;

                    // Quitar loading
                    loadingOverlay.classList.add('hidden');

                } else {
                    alert("El pedido no existe.");
                    window.location.href = "/catalogo.html";
                }
            } catch (error) {
                console.error("Error cargando pedido:", error);
                alert("Error al cargar detalles del pedido.");
            }
        }


        // --- PASO 1: DEL FORMULARIO AL RESUMEN ---
        form.addEventListener('submit', (e) => {
            e.preventDefault();

            if (!currentUser) return;

            let hh = document.getElementById('hora-hh').value.padStart(2, '0');
            let mm = document.getElementById('hora-mm').value.padStart(2, '0');
            let ampm = document.getElementById('hora-ampm').value;

            if (parseInt(hh) > 12 || parseInt(hh) < 1) { alert("Hora inv√°lida"); return; }
            if (parseInt(mm) > 59) { alert("Minutos inv√°lidos"); return; }

            const horaFormateada = `${hh}:${mm} ${ampm.toUpperCase()}`;
            const nombre = document.getElementById('nombre').value.trim();
            const banco = document.getElementById('banco').value;
            const fecha = document.getElementById('fecha').value;

            if (!nombre || !banco || !fecha) {
                alert("Por favor completa todos los campos.");
                return;
            }

            tempData = { nombre, banco, fecha, horaFormateada };

            // Llenar resumen
            document.getElementById('summary-nombre').textContent = nombre;
            document.getElementById('summary-banco').textContent = banco;
            document.getElementById('summary-fecha').textContent = fecha;
            document.getElementById('summary-hora').textContent = horaFormateada;

            formContent.classList.add('hidden');
            summaryContent.classList.remove('hidden');
        });

        // --- PASO 2A: EDITAR ---
        btnEdit.addEventListener('click', () => {
            summaryContent.classList.add('hidden');
            formContent.classList.remove('hidden');
        });

        // --- PASO 2B: CONFIRMAR (Crear Validaci√≥n) ---
        btnConfirm.addEventListener('click', async () => {
            if (!currentOrder || !orderId) return;

            btnConfirm.disabled = true;
            loadingIndicator.classList.remove('hidden');

            try {
                // Reportar en solicitudes_validacion
                await addDoc(collection(db, "solicitudes_validacion"), {
                    uid: currentUser.uid,
                    email: currentUser.email,
                    nombre_usuario: currentUser.displayName || "Usuario",

                    // Datos del reporte manual
                    nombre_titular: tempData.nombre,
                    banco_origen: tempData.banco,
                    fecha_transaccion: tempData.fecha,
                    hora_transaccion_reportada: tempData.horaFormateada,

                    // Vinculaci√≥n con MarketPlace
                    order_id: orderId,
                    type: "marketplace_purchase", // Flag importante para distinguir de suscripciones

                    monto_esperado: orderTotal, // Para validaci√≥n r√°pida del admin
                    monto_reportado_usuario: orderTotal, // Asumimos que paga lo que debe

                    estado: "pendiente",
                    metodo: "bre_b_keys",
                    fecha_creacion: serverTimestamp()
                });

                // Opcional: Actualizar estado de la orden a 'verificando_pago' si se desea
                // await updateDoc(doc(db, "orders", orderId), { status: 'verificando_pago' });

                setTimeout(() => {
                    summaryContent.classList.add('hidden');
                    successContent.classList.remove('hidden');
                }, 1000);

            } catch (error) {
                console.error("Error enviando reporte:", error);
                alert("Error de conexi√≥n. Intenta nuevamente.");
                btnConfirm.disabled = false;
                loadingIndicator.classList.add('hidden');
            }
        });

    </script>
</body>

</html>